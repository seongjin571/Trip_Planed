<html>

<head>
    <meta charset="UTF-8">
    <title>plan</title>
    <link rel="stylesheet" href="/css/plan.css">
    <link rel="stylesheet" href="/css/planchart.css">
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
</head>

<body>
    <div>
        <div class="header">
            <a href="/main">
                <img src="/images/logo.png" alt="트립 프랜드 로고" class="logo-img">
            </a>
            <ul class="nav">
                <li class="nav-list"><a class="nav-link" href="/mypage">마이페이지</a></li>
                <li class="nav-list"><a class="nav-link" href="shareplan">공유계획</a></li>
                <li class="nav-list"><a class="nav-link" href="/logout">로그아웃</a></li>
            </ul>
        </div>
        <img class="trip-location" src="/images/back.png" width="100%" height="auto" />
        <!-- <p class="location-name">가평</p> -->
        <h1 class="plan-title" data-totalDay=5><%= result.plan_title %></h1>
        <div class="plan-container">
            <% for(let i = 0; i < result.total_day; i++){ %>
            <div class="plan-day" data-day=<%= i+1 %>>
                <div class="day-count"><%= i+1 %> Day (<%= dayArr[i] %>)</div>
                <div class="plan-day-wrap">
                    <div class="add-plan" data-day=<%= i+1 %>>
                        <button class="add-direct" data-day=<%= i+1 %>>일정 추가</button>
                    </div>
                </div>
            </div>
            <% } %>
        </div>
        <button class="store-plan-btn">계획 저장</button>

        <div class="tour-dest-container">
            <div class="tour-dest-wrap">
                <h1 class="tour-dest"><%= result.big_location %> <%= result.small_location %></h1>
                <select name="tour-type" class="tour-type" data-big="<%= result.select_big_location %>"
                    data-small="<%= result.select_small_location %>">
                    <option value>전체</option>
                    <option value="12">관광지</option>
                    <option value="14">문화 시설</option>
                    <option value="15">행사/공연/축제</option>
                    <option value="28">레포츠</option>
                    <option value="32">숙박</option>
                    <option value="38">쇼핑</option>
                    <option value="39">음식점</option>
                </select>
                <ul class="tour-dest-ul">
                </ul>
            </div>
        </div>
        <div class="footer">
            <div class="copy-rights">
                © 2019 2H&A. All rights reserved.
            </div>
        </div>
    </div>
    </div>

    <div class="add-plan-container">
        <div class="add-plan-wrap">
            <div class="add-plan-verti-div">
                <div class="add-plan-content">
                    <h1><span class="day"></span>Day</h1>
                    <label for="start-time">시작 시간</label><input type="time" name="startTime" class="input-start-time" />
                    <label for="finish-time">종료 시간</label><input type="time" name="finsihTime"
                        class="input-finish-time" /><br />
                    <label for="plan-content">일정 내용</label><br />
                    <input type="text" name="planContent" id="plan-content" class="input-plan-content" />
                    <button class="add-plan-btn">일정 추가</button>
                </div>
            </div>
        </div>
    </div>

    <div class="tour-info-container">
        <div class="tour-info-wrap">
            <div class="tour-info-verti-div">
                <div class="tour-info-content">
                    <div class="tour-img">
                    </div>
                    <div class="tour-content">
                        <h2 class="tour-name"></h2>
                        <div class="tour-info">
                            <p>강원도 춘천시 남산면 방하리에 있는 섬. | 명칭 유래 남이섬이라는 지명은 남이(南怡) 장군의 묘소로부터 유래하였다. 그러나 남이 장군의 묘소가 섬 어디에
                                있는지는
                                정확히 알려지지 않고 있다. 자연환경 강원도 춘천시와 경기도 가평군의 경계를 이루고 있으며 어쩌구 저쩌구 하면서 그렇다고 이러아아훅 오</p>
                            <p>입장료 : 30,000원</p>
                            <p>위치 : 강원 춘천시 남산면 남이섬길 1
                                구(지번) 주소
                                남산면 방하리 198 (지번)</p>
                            <p>전화 번호 : 031-580-8114</p>
                            <p>운영 시간 : 09:00 ~ 22:00</p>
                        </div>
                        <div class="add-tour">
                            <label for="select-day">날짜 선택</label>
                            <select name="day" id="select-day">
                                <option value=1 selected="selected">1Day</option>
                                <option value=2>2Day</option>
                                <option value=3>3Day</option>
                                <option value=4>4Day</option>
                                <option value=5>5Day</option>
                            </select><br />
                            <label for="start-time">시작 시간</label><input type="time" name="startTime"
                                class="input-start-time" />
                            <label for="finish-time">종료 시간</label><input type="time" name="finsihTime"
                                class="input-finish-time" /><br />
                            <button class="add-tour-plan-btn">일정 추가</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="template-direct" class="template-direct">
            <div class="one-plan">
                <span class="plan-delete-btn{day}" data-day={day}>&times;</span>
                <div class="time">
                    <input name="startTime" value={startTime} readonly class="start-time" />
                    <span> - </span>
                    <input name="finishTime" value={finishTime} readonly class="finish-time" />
                </div>
                <div class="detail-plan">
                        <input name="planContent" value='{planContent}' readonly class="plan-content" />
                </div>
            </div>

</script>
<script type="template-tour" class="template-tour">
        <div class="one-plan">
                <img src="images/tour.png" class="eiffel-img">
                <span class="plan-delete-btn{day}" data-day={day}>&times;</span>
                <div class="time">
                    <input name="startTime" value={startTime} readonly class="start-time" />
                    <span> - </span>
                    <input name="finishTime" value={finishTime} readonly class="finish-time" />
                </div>
                <div class="detail-plan">
                        <input id="tour-input" name="planContent" value='{planContent}' readonly class="plan-content" />
                </div>
            </div>
</script>
<script type="template-tour" class="template-tour-list">
            <li class='tour-dest-list' data-id={tourId} data-type-id={typeId}>
                <img class='tour-dest-img' src={tourImg} onerror="this.src='/images/tour1.jpg'"></img>
                <h4 class='tour-dest-content'>{tourName}</h4>
            </li>
</script>
<script src="/js/plan.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

<script>
    const selTourType = document.querySelector('.tour-type');
    const bigLocation = selTourType.dataset.big;
    const smallLocation = selTourType.dataset.small;
    const tourUl = document.querySelector('.tour-dest-ul');
    const templateHtml = document.querySelector('.template-tour-list').innerHTML;
    $.ajax({
        url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaBasedList?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&areaCode=" + bigLocation + "&sigunguCode=" + smallLocation + "&numOfRows=100&MobileOS=ETC&MobileApp=AppTest",
        dataType: "json",
        success: function (result) {
                addTourList(result);
        }
    });

    selTourType.addEventListener('change', function () {
        tourUl.innerHTML = "";
        $.ajax({
            url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaBasedList?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&areaCode=" + bigLocation + "&sigunguCode=" + smallLocation + "&contentTypeId=" + this.value + "&numOfRows=100&MobileOS=ETC&MobileApp=AppTest",
            dataType: "json",
            success: function (result) {
                addTourList(result);
            }
        });
    })
    function addTourList(result) {
        let newTourHTML = '';
        let tourData;
        $.each(result.response.body.items.item, function (i, data) {
            console.log(data);
            tourData = data;
            newTourHTML += templateHtml.replace('{tourId}', data.contentid)
                .replace('{typeId}', data.contenttypeid)
                .replace('{tourImg}', data.firstimage)
                .replace('{tourName}', data.title);
            tourUl.innerHTML = newTourHTML;
        });
        const tourList = document.querySelectorAll('.tour-dest-list');
        tourList.forEach(function (e) {
            e.addEventListener('click', function () {
            // $.ajax({
            //     url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/detailIntro?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&contentId=" + e.dataset.id + "&contentTypeId="+ e.dataset.typeId +"&numOfRows=50&MobileOS=ETC&MobileApp=AppTest",
            //     dataType: "json",
            //     success: function(result){
            //         console.log(result);
            //     }
            // });
            $.ajax({
                url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/detailCommon?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&contentId="+e.dataset.id+"&defaultYN=Y&addrinfoYN=Y&overviewYN=Y&MobileOS=ETC&MobileApp=AppTest",
                dataType: "json",
                success: function(result){
                    console.log(result);
                }
            });
            // document.querySelector('.tour-info-container').style.display = "block";
            })
        });
    }
</script>

</html>