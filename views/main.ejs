<html>

<head>
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/footer.css">

    <script type="text/javascript">

    </script>
</head>

<body>
    <div class="header">
        <a href="/main">
            <img src="/images/logo.png" alt="트립 프랜드 로고" class="logo-img">
        </a>
        <ul class="nav">
            <li class="nav-list"><a class="nav-link" href="/mypage">마이페이지</a></li>
            <li class="nav-list"><a class="nav-link" href="/api/shareplan">공유계획</a></li>
            <li class="nav-list"><a class="nav-link" href="/logout">로그아웃</a></li>
        </ul>
    </div>
    <img class="trip-location" src="/images/mainpage.png" width="100%" height="auto" />
    <div class="make-plan-container">
        <form action="/api/makeplan" method="post" class="make-plan-form">
            <h1>계획 생성</h1>
            <div>
                <img src="/images/nocheck.png" alt="체크 이미지" class="nocheck-img">
                <img src="/images/check.png" alt="체크 이미지" class="check-img">
                <label for="plan-title">여행 제목</label>
                <input type="text" id="plan-title" name="plan_title" class="plan-title">
            </div>
            <div>
                <img src="/images/nocheck.png" alt="체크 이미지" class="nocheck-img">
                <img src="/images/check.png" alt="체크 이미지" class="check-img">
                <label for="select-loction">지역선택</label>
                <select name="select_big_location" class="select-location">
                    <option>선택하세요</option>
                    <option value="1">서울</option>
                    <option value="2">인천</option>
                    <option value="3">대전</option>
                    <option value="4">대구</option>
                    <option value="5">광주</option>
                    <option value="6">부산</option>
                    <option value="7">울산</option>
                    <option value="31">경기도</option>
                    <option value="32">강원도</option>
                    <option value="33">충청북도</option>
                    <option value="34">충청남도</option>
                    <option value="35">경상북도</option>
                    <option value="36">경상남도</option>
                    <option value="37">전라북도</option>
                    <option value="38">전라남도</option>
                    <option value="39">제주도</option>
                </select>
                <select name="select_small_location" class="select-small-location">
                    <option>선택하세요</option>
                </select>
                <input type="text" name="big_location" class="big-location location" />
                <input type="text" name="small_location" class="small-location location" />
            </div>
            <div>
                <img src="/images/nocheck.png" alt="체크 이미지" class="nocheck-img">
                <img src="/images/check.png" alt="체크 이미지" class="check-img">
                <label for="select-day">시작일</label>
                <button type="button" class="select-day-button" data-count=0>날짜 선택</button>
                <input type="text" name="start_day" readonly class="day-input">
            </div>
            <div>
                <img src="/images/nocheck.png" alt="체크 이미지" class="nocheck-img">
                <img src="/images/check.png" alt="체크 이미지" class="check-img">
                <label for="select-day">종료일</label>
                <button type="button" class="select-day-button" data-count=1>날짜 선택</button>
                <input type="text" name="finish_day" readonly class="day-input">
            </div>
            <input type="text" name="total_day" class="total-day" />
            <button class="make-plan-btn">계획 만들기</button>
        </form>
    </div>

    <div class="calendar-container">
        <div class="calendar-wrap">
            <div class="calendar-verti-div">
                <table class="calendar" border="3" align="center">
                    <tr>
                        <td onclick="prevCalendar()">
                            <label>
                                <</label> </td> <td align="center" class="tbCalendarYM" colspan="5"><span
                                        class="year">yyyy</span>년 <span class="month">m</span>월</td>
                        <td onclick="nextCalendar()">
                            <label>></label>
                        </td>
                    </tr>
                    <tr class="day">
                        <td align="center">
                            <font color="#F79DC2">일
                        </td>
                        <td align="center">월</td>
                        <td align="center">화</td>
                        <td align="center">수</td>
                        <td align="center">목</td>
                        <td align="center">금</td>
                        <td align="center">
                            <font color="skyblue">토
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="copy-rights">
            © 2019 2H&A. All rights reserved.
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script language="javascript" type="text/javascript">

        const selectLoction = document.querySelector('.select-location');
        selectLoction.addEventListener('change', function () {
            document.querySelector('.big-location').value = this.options[this.selectedIndex].text;
            const url = "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaCode?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&areaCode=" + this.value + "&numOfRows=100&pageNo=1&MobileOS=ETC&MobileApp=AppTest";
            $.ajax({
                url: url,
                dataType: "json",
                success: function (result) {
                    console.log(result);
                    const smallLocation = document.querySelector('.select-small-location');
                    smallLocation.innerHTML = "";
                    smallLocation.innerHTML = "<option>선택하세요</option>";
                    $.each(result.response.body.items.item, function (i, d) {
                        smallLocation.innerHTML += '<option value =' + d.code + ">" + d.name + "</option>";
                    });
                }
            });
        })


        function calDay() {
            const startDay = document.getElementsByClassName("day-input")[0].value;
            const finishDay = document.getElementsByClassName("day-input")[1].value;
            const ar1 = startDay.split('-');
            const ar2 = finishDay.split('-');
            const da1 = new Date(ar1[0], ar1[1], ar1[2]);
            const da2 = new Date(ar2[0], ar2[1], ar2[2]);
            const dif = da2 - da1;
            const cDay = 24 * 60 * 60 * 1000;
            const cMonth = cDay * 30;
            const cYear = cMonth * 12;
            if (startDay && finishDay) {
                return parseInt(dif / cDay) + 1;
            }
        }

        let today = new Date();
        let date = new Date();
        function prevCalendar() {
            today = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            buildCalendar(0);
        }
        function nextCalendar() {
            today = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
            buildCalendar(1);
        }
        let yearWrap;
        let monthWrap;

        function buildCalendar(index) {
            const doMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

            const tbCalendar = document.querySelector(".calendar");
            const tbCalendarYM = document.querySelector(".tbCalendarYM");
            yearWrap = document.querySelector('.year');
            monthWrap = document.querySelector('.month');
            yearWrap.innerHTML = today.getFullYear();
            monthWrap.innerHTML = (today.getMonth() + 1);

            while (tbCalendar.rows.length > 2) {
                tbCalendar.deleteRow(tbCalendar.rows.length - 1);
            }
            let row = tbCalendar.insertRow();
            row.className = 'row-day';
            let count = 0;
            for (i = 0; i < doMonth.getDay(); i++) {
                cell = row.insertCell();
                count = count + 1;
            }
            for (i = 1; i <= lastDate.getDate(); i++) {
                cell = row.insertCell();
                cell.innerHTML = i;
                count = count + 1;
                if (count % 7 == 1) {
                    cell.className = "sunday";

                }
                if (count % 7 == 0) {
                    cell.className = "saturday";
                    row = tbCalendar.insertRow();
                    row.className = 'row-day';
                }
                if (today.getFullYear() == date.getFullYear()
                    && today.getMonth() == date.getMonth()
                    && i == date.getDate()) {
                    cell.bgColor = "#FAF58C";
                }
            }

            const day = document.querySelectorAll('.row-day>td');
            const calendarContainer = document.querySelector('.calendar-container');
            day.forEach(function (v) {
                v.addEventListener('click', function (c) {
                    const dateInput = document.getElementsByClassName('day-input')[index];
                    dateInput.value = yearWrap.innerHTML + '-' + monthWrap.innerHTML + '-' + c.target.innerHTML;
                    calendarContainer.style.display = 'none';
                    const totalDay = calDay();
                    if (totalDay < 1) {
                        alert('날짜를 다시 선택해 주세요');
                        cancelCheck(2);
                        cancelCheck(3);
                        document.getElementsByClassName('day-input')[0].value = "";
                        document.getElementsByClassName('day-input')[1].value = "";
                    }
                    else {
                        document.querySelector('.total-day').value = totalDay;
                        calendarContainer.style.display = 'none';
                        doCheck(Number(index) + 2);
                    }
                })
            })
        }

        doCheck = function (index) {
            document.getElementsByClassName('check-img')[index].style.display = 'inline';
            document.getElementsByClassName('nocheck-img')[index].style.display = 'none';
            this.count++;
        }

        cancelCheck = function (index) {
            document.getElementsByClassName('check-img')[index].style.display = 'none';
            document.getElementsByClassName('nocheck-img')[index].style.display = 'inline';
            if (this.count > 0) this.count--;
        }

        function makePlan() {
            this.count = 0;
            this.selectDayBtn = document.querySelectorAll('.select-day-button');
            this.calendarContainer = document.querySelector('.calendar-container');
            this.planTitle = document.querySelector('.plan-title');
            this.selectLoction = document.querySelector('.select-small-location');
            this.enrollEvent();
        }
        makePlan.prototype = {
            enrollEvent: function () {
                this.planTitle.addEventListener('change', function () {
                    if (this.planTitle.value !== '')
                        doCheck(0);
                    else
                        cancelCheck(0);
                }.bind(this));

                this.calendarContainer.addEventListener('click', function (e) {
                    if (e.target.className === 'calendar-verti-div')
                        this.style.display = 'none';
                })

                this.selectDayBtn.forEach(function (e) {
                    e.addEventListener('click', function () {
                        document.querySelector('.calendar-container').style.display = 'block';
                        buildCalendar(e.dataset.count);
                    }.bind(this))
                }.bind(this));

                this.selectLoction.addEventListener('change', function (e) {
                    document.querySelector('.small-location').value = this.selectLoction[this.selectLoction.selectedIndex].text;
                    if (this.selectLoction.value > 0) doCheck(1);
                    else cancelCheck(1);
                }.bind(this));
            },
        }

        const makePlanFun = new makePlan();





    </script>
</body>

</html>