<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script>
    window.onload = function () {
        const okBtn = document.querySelector('.ok-btn');
        okBtn.addEventListener('click', function () {
            const areacode = document.querySelector('.type_select').value;
            document.querySelector('.ul').innerHTML = "";
            getSigunguCode(areacode);
            getFestivInfo(31, 1, 12);
            getInfo(1284247);
            getDetail(1284247,12);
        })

        //contentTypeId = [12:관광지, 14:문화시설, 15:행사/공연/축제, 25:여행코스, 28:레포츠, 32:숙박, 38:쇼핑, 39:음식점]

        $(function () {   //지역코드
            $.ajax({
                url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaCode?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&numOfRows=100&MobileOS=ETC&MobileApp=AppTest",
                dataType: "json",
                success: function (result) {

                    console.log(result);
                }
            });
        });

        function getSigunguCode(areaCode) {  //시군구
            const area = areaCode;

            $.ajax({
                url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaCode?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&areaCode=" + area + "&numOfRows=100&pageNo=1&MobileOS=ETC&MobileApp=AppTest",
                dataType: "json",
                success: function (result) {
                    console.log(result);
                    $.each(result.response.body.items.item, function (i, d) {
                        $("#wrap ul").append("<li>" + "시/군/구 -> " + d.name + "  /  code -> " + d.code + "</li>");
                    });
                }
            });
        }

        function getFestivInfo(areaCode, sigunguCode, contentTypeId) {  // ex> 서울 광진구에 있는 관광지
            const area = areaCode;
            const sigungu = sigunguCode;
            const content = contentTypeId;

            $.ajax({
                url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaBasedList?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&areaCode="+ area +"&sigunguCode=" + sigungu + "&contentTypeId="+content+"&numOfRows=100&MobileOS=ETC&MobileApp=AppTest",
                dataType: "json",
                success: function (result) {
                    //response.result.body.items.item[0].contentid
                    console.log(result);
                }
            });
        }

        function getInfo(contentId){       //해당 관광지에 대한 정보(개요 부분)
            const content_id = contentId;

            $.ajax({
                url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/detailCommon?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&contentId="+content_id+"&defaultYN=Y&addrinfoYN=Y&overviewYN=Y&MobileOS=ETC&MobileApp=AppTest",
                dataType: "json",
                success: function(result){
                    console.log(result);
                }
            });
        }

        function getDetail(contentId, contentTypeId){  //상세정보
            const content_id = contentId;
            const content_type_id = contentTypeId;

            $.ajax({
                url: "http://api.visitkorea.or.kr/openapi/service/rest/KorService/detailIntro?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&contentId=" + contentId + "&contentTypeId="+content_type_id+"&numOfRows=50&MobileOS=ETC&MobileApp=AppTest",
                dataType: "json",
                success: function(result){
                    console.log(result);
                }
            });
        }
    }
</script>

<body>
    <select name="areaCode" class="type_select" class="select-location">
        <option value="1">서울</option>
        <option value="2">인천</option>
        <option value="3">대전</option>
        <option value="4">대구</option>
        <option value="5">광주</option>
        <option value="6">부산</option>
        <option value="7">울산</option>
        <option value="31">경기도</option>
        <option value="32">강원도</option>
        <option value="33">충청북도</option>
        <option value="34">충청남도</option>
        <option value="35">경상북도</option>
        <option value="36">경상남도</option>
        <option value="37">전라북도</option>
        <option value="38">전라남도</option>
        <option value="39">제주도</option>
    </select>
    <select name="" class="small-location"></select>

    <select name="type" class="type_select__">
        <option value="12">관광지</option>
        <option value="14">문화 시설</option>
        <option value="15">행사/공연/축제</option>
        <option value="25">여행 코스</option>
        <option value="28">레포츠</option>
        <option value="32">숙박</option>
        <option value="38">쇼핑</option>
        <option value="39">음식점</option>
    </select>
    <button class="ok-btn">검색</button>
    <div id="wrap">
        <ul class="ul"></ul>
    </div>

    <script>
        const selectLoction = document.querySelector('.select-location');
        selectLoction.addEventListener('change', function () {
            const url = "http://api.visitkorea.or.kr/openapi/service/rest/KorService/areaCode?ServiceKey=RjJLwUTtegMNM%2Barsc%2BPwTW3xU4RZiJFAelIy54Z6sGrJuW36IQthQdAOLg1ZhdXbDD6H1EiuBs2IiOpL3umlQ%3D%3D&areaCode=" + this.value + "&numOfRows=100&pageNo=1&MobileOS=ETC&MobileApp=AppTest";
            $.ajax({
                url: url,
                dataType: "json",
                success: function (result) {
                    const smallLocation = document.querySelector('.small-location');
                    smallLocation.innerHTML = "";
                    $.each(result.response.body.items.item, function (i, d) {
                        smallLocation.innerHTML += '<option value =' + d.code + ">" + d.name + "</option>";
                    });
                }
            });
        })
    </script>
</body>

</html>